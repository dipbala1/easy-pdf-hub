<script>
    const uploadBtn   = document.getElementById('uploadBtn');
    const fileInput   = document.getElementById('fileInput');
    const fileName    = document.getElementById('fileName');
    const fileNameTxt = document.getElementById('fileNameText');
    const spinner     = document.getElementById('spinner');
    const downloadBtn = document.getElementById('downloadBtn');

    let convertedBlob = null; // Store the result

    uploadBtn.addEventListener('click', () => fileInput.click());

    fileInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        fileNameTxt.textContent = file.name;
        fileName.classList.add('show');
        uploadBtn.style.display = 'none';
        spinner.style.display = 'block';

        try {
            const response = await fetch("https://api.cloudmersive.com/convert/pdf/to/docx", {
                method: "POST",
                headers: {
                    "Apikey": "38b77f625ff1a1fb40e22b5de2d45c5bd4f3db0d9d10fee54c0c8666ecef7f6c",
                    "Content-Type": "application/pdf"
                },
                body: file
            });

            if (!response.ok) throw new Error("Conversion failed");

            convertedBlob = await response.blob();

            spinner.style.display = 'none';
            downloadBtn.style.display = 'inline-block';
        } catch (err) {
            spinner.style.display = 'none';
            alert("Something went wrong. Try again.");
            uploadBtn.style.display = 'inline-block';
            console.error(err);
        }
    });

    downloadBtn.addEventListener('click', () => {
        if (convertedBlob) {
            const url = window.URL.createObjectURL(convertedBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = "converted.docx";
            a.click();
        } else {
            window.location.href = 'download-page.html'; // fallback
        }
    });
</script>

